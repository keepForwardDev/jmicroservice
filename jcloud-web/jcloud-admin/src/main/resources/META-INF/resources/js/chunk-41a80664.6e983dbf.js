(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-41a80664"],{"0777":function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"a",(function(){return a}));i("3fab"),i("3f27"),i("8130"),i("a9b6");var r=function(e){return e?[{required:!0,message:e,trigger:"blur"}]:[{required:!0,message:"该项为必填项，请填写完整！",trigger:"blur"}]},a=function(e,t,i){if(""!==t){var r=/^\w+$/;r.test(t)?i():i(new Error("只能填写 字母、数字、下划线组成的字符串！"))}else i()}},"29b5":function(e,t,i){},5135:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-drawer",{attrs:{title:e.drawerTitle,visible:e.drawerVisible,direction:"rtl",size:"30%","before-close":e.handleDrawerClose},on:{"update:visible":function(t){e.drawerVisible=t}}},[i("el-scrollbar",{staticClass:"drawer-scrollbar",staticStyle:{height:"calc(100vh - 150px)"}},[i("div",{staticClass:"drawer-content"},[1===e.privileges.resourceType?i("div",{staticClass:"drawer-item"},[e._v(" 服务名称： "),i("el-select",{on:{change:e.changeService},model:{value:e.privileges.serviceId,callback:function(t){e.$set(e.privileges,"serviceId",t)},expression:"privileges.serviceId"}},e._l(e.apiResources,(function(e){return i("el-option",{key:e.url,attrs:{label:e.name,value:e.url}})})),1)],1):e._e(),i("div",{staticClass:"drawer-item"},[i("el-tree",{ref:"treeBox",attrs:{"default-expand-all":"","empty-text":"当前暂无数据","show-checkbox":"","node-key":"id",data:e.treeList},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.data;return i("span",{staticClass:"custom-tree-node"},[i("span",{staticClass:"tree-title",attrs:{title:r.extra}},[e._v(e._s(r.label))]),1===e.privileges.resourceType?i("i",{staticClass:"el-icon-edit-outline closeBtn",attrs:{title:"修改api调用次数"},on:{click:function(t){return e.editLimit(r)}}}):e._e()])}}])})],1)])]),i("div",{staticClass:"drawer-footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.savePrivileges}},[e._v("保存")])],1)],1),i("el-dialog",{attrs:{title:"api调用限制",visible:e.dialogFormVisible1,width:"500px"},on:{"update:visible":function(t){e.dialogFormVisible1=t}}},[i("el-form",{ref:"form1",attrs:{model:e.formData1,"label-width":"120px",rules:e.formRules1}},[i("el-form-item",{attrs:{label:"api调用路径"}},[i("span",[e._v(e._s(e.formData1.apiPath))])]),i("el-form-item",{attrs:{label:"调用次数",prop:"apiLimit"}},[i("el-input",{attrs:{type:"number"},model:{value:e.formData1.apiLimit,callback:function(t){e.$set(e.formData1,"apiLimit",t)},expression:"formData1.apiLimit"}})],1),i("el-form-item",{attrs:{label:"调用策略"}},[i("el-select",{model:{value:e.formData1.apiLimitStrategy,callback:function(t){e.$set(e.formData1,"apiLimitStrategy",t)},expression:"formData1.apiLimitStrategy"}},[i("el-option",{attrs:{label:"次数",value:0}}),i("el-option",{attrs:{label:"每天",value:1}})],1)],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible1=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.saveForm1}},[e._v("确定")])],1)],1)],1)},a=[],s=i("efbe"),o=(i("a9b6"),i("c284"),i("44ad"),i("0777")),l={name:"privileges",data:function(){return{treeList:[],dialogFormVisible1:!1,drawerVisible:!1,formData1:{apiPath:"",apiLimit:"",apiLimitStrategy:0},editNode:{},formRules1:{apiLimit:Object(o["b"])()}}},props:{drawerTitle:{type:String,default:""},privileges:{type:Object,default:function(){return{resourceIds:[],apiConfig:[],id:"",resourceType:0,privilegeType:1,serviceId:""}}},apiResources:{type:Array,default:function(){return[]}},menuTreeList:{type:Array,default:function(){return[]}},resourceTreeList:{type:Array,default:function(){return[]}}},mounted:function(){},methods:{changeService:function(e){this.getPrivileges()},handleDrawerClose:function(e){e()},savePrivileges:function(){var e=this,t=this.$refs.treeBox.getCheckedNodes(),i=this.$refs.treeBox.getCheckedKeys(),r=this.$refs.treeBox.getHalfCheckedKeys(),a=[];1===this.privileges.resourceType?(t.forEach((function(e){e.children||a.push({apiPath:e.data.apiPath,apiLimit:e.data.apiLimit,apiLimitStrategy:e.data.apiLimitStrategy})})),this.privileges.resourceIds=[],this.privileges.apiConfig=a):this.privileges.resourceIds=[].concat(Object(s["a"])(i),Object(s["a"])(r)),this.$postJson("/admin/privilege/savePrivileges",this.privileges).then((function(t){1===t.code&&e.$message.success(t.msg)}))},getPrivileges:function(){var e=this;this.$get("/admin/privilege/getPrivileges",{resourceType:this.privileges.resourceType,id:this.privileges.id,privilegeType:this.privileges.privilegeType,serviceId:this.privileges.serviceId}).then((function(t){1===t.code&&(0===e.privileges.resourceType?e.treeList=e.menuTreeList:1===e.privileges.resourceType?(e.treeList=t.data.apiTree,e.privileges.apiConfig=t.data.apiConfig):e.treeList=e.resourceTreeList,e.$nextTick((function(){t.data.resourceIds.forEach((function(t){e.$refs.treeBox.setChecked(t,!0,!1)}))})))}))},editLimit:function(e){this.dialogFormVisible1=!0,this.editNode=e,this.formData1.apiPath=e.data.apiPath,this.formData1.apiLimit=e.data.apiLimit,this.formData1.apiLimitStrategy=e.data.apiLimitStrategy},saveForm1:function(){var e=this;this.$refs.form1.validate((function(t,i){t?(e.editNode.data.apiPath=e.formData1.apiPath,e.editNode.data.apiLimit=e.formData1.apiLimit,e.editNode.data.apiLimitStrategy=e.formData1.apiLimitStrategy,e.dialogFormVisible1=!1):e.$message({message:"请完善相关信息填写！",type:"warning"})}))},showDrawer:function(){this.drawerVisible=!0}}},n=l,c=(i("5b92"),i("cba8")),p=Object(c["a"])(n,r,a,!1,null,"2f6772dc",null);t["default"]=p.exports},5426:function(e,t,i){var r=i("1111").PROPER,a=i("b68d"),s=i("de35"),o="​᠎";e.exports=function(e){return a((function(){return!!s[e]()||o[e]()!==o||r&&s[e].name!==e}))}},"5b92":function(e,t,i){"use strict";i("29b5")},8130:function(e,t,i){"use strict";var r=i("a5ba"),a=i("e280").trim,s=i("5426");r({target:"String",proto:!0,forced:s("trim")},{trim:function(){return a(this)}})}}]);