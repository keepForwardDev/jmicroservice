(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-178a59a9","chunk-2d21f8c7"],{"6ba16":function(e,t,n){},a93b:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"table-aside"},[n("div",{staticStyle:{display:"flex",height:"calc(100vh - 200px)"}},[n("el-scrollbar",{staticClass:"project-table"},[n("div",[n("node-menu",{ref:"nodeMenu",attrs:{menuList:e.tableList},on:{addNode:e.addNode,dataReload:e.dataReload}})],1)]),n("el-scrollbar",[e.easyFlowVisible?n("div",{directives:[{name:"flowDrag",rawName:"v-flowDrag"}],ref:"efContainer",attrs:{id:"efContainer1"}},[e._l(e.data.nodeList,(function(t){return[n("flow-node",{key:t.id,attrs:{id:t.id,node:t,activeElement:e.activeElement},on:{changeNodeSite:e.changeNodeSite,nodeRightMenu:e.nodeRightMenu,clickNode:e.clickNode}})]}))],2):e._e()])],1),n("el-dialog",{attrs:{title:"编辑信息",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[n("el-form",{directives:[{name:"show",rawName:"v-show",value:"node"===e.activeElement.type,expression:"activeElement.type === 'node'"}],ref:"dataForm",attrs:{model:e.node,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"表名"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.node.type,callback:function(t){e.$set(e.node,"type",t)},expression:"node.type"}})],1),n("el-form-item",{attrs:{label:"名称"}},[n("el-input",{attrs:{disabled:!e.node.id},model:{value:e.node.name,callback:function(t){e.$set(e.node,"name",t)},expression:"node.name"}})],1),n("el-form-item",{attrs:{label:"left坐标"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.node.left,callback:function(t){e.$set(e.node,"left",t)},expression:"node.left"}})],1),n("el-form-item",{attrs:{label:"top坐标"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.node.top,callback:function(t){e.$set(e.node,"top",t)},expression:"node.top"}})],1),n("el-form-item",{attrs:{label:"ico图标"}},[n("el-input",{attrs:{disabled:!e.node.id},model:{value:e.node.ico,callback:function(t){e.$set(e.node,"ico",t)},expression:"node.ico"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:e.repaintEverything}},[e._v("保存")])],1)],1),n("el-form",{directives:[{name:"show",rawName:"v-show",value:"line"===e.activeElement.type,expression:"activeElement.type === 'line'"}],ref:"dataForm",attrs:{model:e.node,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"条件"}},[n("el-input",{model:{value:e.node.label,callback:function(t){e.$set(e.node,"label",t)},expression:"node.label"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:function(t){return e.setLineLabel(e.node.from,e.node.to,e.node.label)}}},[e._v("保存")])],1)],1)],1)],1)},o=[],a=(n("a9b6"),n("c284"),n("3e22"),n("3bdf"),n("28fd"),n("162b"),n("25d5")),s=n.n(a),l=(n("a778"),n("ab70")),c=n("c014"),r=n("d9fb"),d=n("1ce7"),u=n("a837"),m=n("f779"),f=n("7c98"),h=n.n(f),p={props:{dataList:{type:Array,default:function(){return[]}}},computed:{tableList:function(){var e=[];return this.dataList.forEach((function(t){var n=[],i={id:t.id+"",type:"group",name:t.name,ico:"el-icon-video-play",open:!1,children:n};t.tables.forEach((function(e){n.push({id:e.id,dataSourceInfoId:e.dataSourceInfoId,type:e.dataSourceTableName+"#"+e.dataSourceInfoId,name:e.tableName?e.tableName:e.dataSourceTableName,ico:"fa fa-arrows",style:{}})})),e.push(i)})),e}},data:function(){return{jsPlumb:null,easyFlowVisible:!0,flowInfoVisible:!1,loadEasyFlowFinish:!1,flowHelpVisible:!1,activeElement:{type:void 0,nodeId:void 0,sourceId:void 0,targetId:void 0},data:{nodeList:[],lineList:[]},zoom:.5,node:{},dialogFormVisible:!1,projectDicId:""}},mixins:[l["a"]],components:{draggable:s.a,flowNode:c["a"],nodeMenu:r["default"],FlowInfo:d["a"],FlowNodeForm:m["a"],FlowHelp:u["a"]},directives:{flowDrag:{bind:function(e,t,n,i){t&&(e.onmousedown=function(t){if(2!=t.button){var n=t.clientX,i=t.clientY;e.style.cursor="move",document.onmousemove=function(t){t.preventDefault();var o=t.clientX-n;n=t.clientX,e.scrollLeft+=-o;var a=t.clientY-i;i=t.clientY,e.scrollTop+=-a},document.onmouseup=function(t){e.style.cursor="auto",document.onmousemove=null,document.onmouseup=null}}})}}},mounted:function(){this.jsPlumb=jsPlumb.getInstance()},methods:{getUUID:function(){return Math.random().toString(36).substr(3,10)},jsPlumbInit:function(){var e=this;this.jsPlumb.ready((function(){e.jsPlumb.importDefaults(e.jsplumbSetting),e.jsPlumb.setSuspendDrawing(!1,!0),e.loadEasyFlow(),e.jsPlumb.bind("click",(function(t,n){e.activeElement.type="line",e.activeElement.sourceId=t.sourceId,e.activeElement.targetId=t.targetId,e.node={from:t.sourceId,to:t.targetId,label:t.getLabel()},e.$emit("enableBtn")})),e.jsPlumb.bind("connection",(function(t){var n=t.source.id,i=t.target.id;e.loadEasyFlowFinish&&e.data.lineList.push({from:n,to:i})})),e.jsPlumb.bind("connectionDetached",(function(t){e.deleteLine(t.sourceId,t.targetId)})),e.jsPlumb.bind("connectionMoved",(function(t){e.changeLine(t.originalSourceId,t.originalTargetId)})),e.jsPlumb.bind("contextmenu",(function(e){console.log("contextmenu",e)})),e.jsPlumb.bind("beforeDrop",(function(t){var n=t.sourceId,i=t.targetId;return n===i?(e.$message.error("节点不支持连接自己"),!1):e.hasLine(n,i)?(e.$message.error("该关系已存在,不允许重复创建"),!1):e.hashOppositeLine(n,i)?(e.$message.error("不支持两个节点之间连线回环"),!1):(e.$message.success("连接成功"),!0)})),e.jsPlumb.bind("beforeDetach",(function(e){console.log("beforeDetach",e)})),e.jsPlumb.setContainer(e.$refs.efContainer)}))},loadEasyFlow:function(){this.jsPlumb.deleteConnectionsForElement();for(var e=0;e<this.data.nodeList.length;e++){var t=this.data.nodeList[e];this.jsPlumb.makeSource(t.id,h.a.merge(this.jsplumbSourceOptions,{})),this.jsPlumb.makeTarget(t.id,this.jsplumbTargetOptions),t.viewOnly||this.jsPlumb.draggable(t.id,{containment:"parent",stop:function(e){console.log("拖拽结束: ",e)}})}for(e=0;e<this.data.lineList.length;e++){var n=this.data.lineList[e],i={source:n.from,target:n.to,label:n.label?n.label:"",connector:n.connector?n.connector:"",anchors:n.anchors?n.anchors:void 0,paintStyle:n.paintStyle?n.paintStyle:void 0};this.jsPlumb.connect(i,this.jsplumbConnectOptions)}this.$nextTick((function(){this.loadEasyFlowFinish=!0}))},setLineLabel:function(e,t,n){var i=this.jsPlumb.getConnections({source:e,target:t})[0];n&&""!==n?i.addClass("flowLabel"):(i.removeClass("flowLabel"),i.addClass("emptyFlowLabel")),i.setLabel({label:n}),this.data.lineList.forEach((function(i){i.from==e&&i.to==t&&(i.label=n)})),this.dialogFormVisible=!1},deleteElement:function(){var e=this;"node"===this.activeElement.type?this.deleteNode(this.activeElement.nodeId):"line"===this.activeElement.type&&this.$confirm("确定删除所点击的线吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=e.jsPlumb.getConnections({source:e.activeElement.sourceId,target:e.activeElement.targetId})[0];e.jsPlumb.deleteConnection(t)})).catch((function(){}))},deleteLine:function(e,t){this.data.lineList=this.data.lineList.filter((function(n){return n.from!=e||n.to!=t})),this.activeElement.type="",this.activeElement.nodeId=""},changeLine:function(e,t){this.deleteLine(e,t)},changeNodeSite:function(e){for(var t=0;t<this.data.nodeList.length;t++){var n=this.data.nodeList[t];n.id===e.nodeId&&(n.left=e.left,n.top=e.top)}},addNode:function(e,t,n){var i=e.originalEvent.clientX,o=e.originalEvent.clientY,a=this.$refs.efContainer,s=a.getBoundingClientRect(),l=i,c=o;if(l<s.x||l>s.width+s.x||c<s.y||s.y>s.y+s.height)this.$message.error("请把节点拖入到画布中");else{l=l-s.x+a.scrollLeft,c=c-s.y+a.scrollTop,l-=85,c-=16;var r=t.type,d=this.data.nodeList.filter((function(e){return e.type===t.type}));if(d.length>0)this.$message.error("该节点已存在画布中！");else{var u={id:r,name:t.name,dataSourceInfoId:t.dataSourceInfoId,type:r,left:l+"px",top:c+"px",ico:t.ico,state:"success"};this.data.nodeList.push(u),this.$nextTick((function(){this.jsPlumb.makeSource(r,this.jsplumbSourceOptions),this.jsPlumb.makeTarget(r,this.jsplumbTargetOptions),this.jsPlumb.draggable(r,{containment:"parent",stop:function(e){console.log("拖拽结束: ",e)}})}))}}},deleteNode:function(e){var t=this;return this.$confirm("确定要删除所选节点","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){t.data.nodeList=t.data.nodeList.filter((function(t){return t.id!==e})),t.$nextTick((function(){this.jsPlumb.removeAllEndpoints(e)})),t.activeElement.type="",t.activeElement.nodeId=""})).catch((function(){})),!0},clickNode:function(e){var t=this;this.activeElement.type="node",this.activeElement.nodeId=e,this.$emit("enableBtn"),this.data.nodeList.filter((function(n){n.id===e&&(t.node=n)}))},hasLine:function(e,t){for(var n=0;n<this.data.lineList.length;n++){var i=this.data.lineList[n];if(i.from===e&&i.to===t)return!0}return!1},hashOppositeLine:function(e,t){return this.hasLine(t,e)},nodeRightMenu:function(e,t){this.menu.show=!0,this.menu.curNodeId=e,this.menu.left=t.x+"px",this.menu.top=t.y+"px"},repaintEverything:function(){this.jsPlumb.repaint(),this.dialogFormVisible=!1},dataInfo:function(){this.flowInfoVisible=!0,this.$nextTick((function(){this.$refs.flowInfo.init()}))},dataReload:function(e,t){var n=this;this.data.lineList=e.lineList,this.data.nodeList=e.nodeList,this.easyFlowVisible=!1,this.projectDicId=t,this.$nextTick((function(){n.easyFlowVisible=!0,n.$nextTick((function(){n.jsPlumb=jsPlumb.getInstance(),n.$nextTick((function(){n.jsPlumbInit()}))}))}))},zoomAdd:function(){this.zoom>=1||(this.zoom=this.zoom+.1,this.$refs.efContainer.style.transform="scale(".concat(this.zoom,")"),this.jsPlumb.setZoom(this.zoom))},zoomSub:function(){this.zoom<=0||(this.zoom=this.zoom-.1,this.$refs.efContainer.style.transform="scale(".concat(this.zoom,")"),this.jsPlumb.setZoom(this.zoom))},saveData:function(){var e=this;this.$postJson("/datacenter/metadata/saveEasyFlow/"+this.projectDicId,this.data).then((function(t){1===t.code&&e.$message.success(t.msg)}))}}},b=p,v=(n("d3ce"),n("cba8")),g=Object(v["a"])(b,i,o,!1,null,"20c7162a",null);t["default"]=g.exports},d3ce:function(e,t,n){"use strict";n("6ba16")},d9fb:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"tool",staticClass:"flow-menu"},e._l(e.menuList,(function(t,i){return n("div",{key:t.id},[n("span",{staticClass:"ef-node-pmenu",on:{click:function(n){return e.openMenu(t,i)}}},[n("el-radio",{attrs:{label:t.id},model:{value:e.projectDicId,callback:function(t){e.projectDicId=t},expression:"projectDicId"}},[e._v(e._s(t.name))]),n("i",{class:{"el-icon-caret-bottom":t.open,"el-icon-caret-right":!t.open},staticStyle:{"padding-left":"30px"}})],1),n("ul",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"menu.open"}],staticClass:"ef-node-menu-ul"},[n("draggable",{attrs:{options:e.draggableOptions},on:{end:e.end,start:e.move},model:{value:t.children,callback:function(n){e.$set(t,"children",n)},expression:"menu.children"}},e._l(t.children,(function(t){return n("li",{key:t.id,staticClass:"ef-node-menu-li",attrs:{title:t.type,type:t.type}},[e._v(" "+e._s(t.name)+" ")])})),0)],1)])})),0)},o=[],a=n("25d5"),s=n.n(a),l={left:-1,top:-1},c={props:{menuList:{type:Array,default:function(){return[]}}},data:function(){return{activeNames:"1",draggableOptions:{preventOnFilter:!1,sort:!1,disabled:!1,ghostClass:"tt",forceFallback:!0},defaultOpeneds:[],nodeMenu:{},projectDicId:"",lastIndex:0}},components:{draggable:s.a},created:function(){this.isFirefox()&&(document.body.ondrop=function(e){l.left=e.layerX,l.top=e.clientY-50,e.preventDefault(),e.stopPropagation()})},mounted:function(){this.menuList.length>0&&(this.projectDicId=this.menuList[0].id,this.changeVal(this.projectDicId))},methods:{getMenuByType:function(e){for(var t=0;t<this.menuList.length;t++)for(var n=this.menuList[t].children,i=0;i<n.length;i++)if(n[i].type===e)return n[i]},move:function(e,t,n,i){var o=e.item.attributes.type.nodeValue;this.nodeMenu=this.getMenuByType(o)},end:function(e,t){this.$emit("addNode",e,this.nodeMenu,l)},isFirefox:function(){var e=navigator.userAgent;return e.indexOf("Firefox")>-1},openMenu:function(e,t){this.lastIndex!==t&&(this.menuList[this.lastIndex].open=!1,this.changeVal(e.id)),this.lastIndex=t,this.projectDicId=e.id,e.open=!e.open,this.$forceUpdate()},changeVal:function(e){var t=this;this.$get("/datacenter/metadata/getEasyFlowTableRelation/"+e).then((function(n){t.$emit("dataReload",n.data,e)}))}}},r=c,d=n("cba8"),u=Object(d["a"])(r,i,o,!1,null,null,null);t["default"]=u.exports}}]);