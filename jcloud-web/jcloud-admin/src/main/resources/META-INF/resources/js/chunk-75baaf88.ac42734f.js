(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-75baaf88","chunk-07eee658","chunk-a2456142","chunk-2d5aab97","chunk-2ed17824"],{"0dd7":function(e,t,a){},"0f7b":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"formWrapper"},[a("el-form",{ref:"form",attrs:{rules:e.rules,model:e.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[a("el-input",{staticClass:"text-input",model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"所属项目",prop:"projectDicId"}},[a("el-select",{staticClass:"text-input",attrs:{placeholder:"请选择所属项目"},model:{value:e.formData.projectDicId,callback:function(t){e.$set(e.formData,"projectDicId",t)},expression:"formData.projectDicId"}},e._l(e.projectList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.value}},[e._v(e._s(t.name))])})),1)],1),a("el-form-item",{attrs:{label:"数据源名称",prop:"dataSourceInfoId"}},[a("el-select",{staticClass:"text-input",attrs:{placeholder:"请选择所属项目"},model:{value:e.formData.dataSourceInfoId,callback:function(t){e.$set(e.formData,"dataSourceInfoId",t)},expression:"formData.dataSourceInfoId"}},e._l(e.dataSourceList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"是否调度"}},[a("el-radio-group",{model:{value:e.formData.isTask,callback:function(t){e.$set(e.formData,"isTask",t)},expression:"formData.isTask"}},[a("el-radio",{attrs:{label:1}},[e._v("是")]),a("el-radio",{attrs:{label:0}},[e._v("否")])],1)],1),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{staticClass:"text-input",attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入内容"},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.nexStep}},[e._v("下一步")]),a("el-button",{on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1)},i=[],s={name:"taskInfo",props:{formData:{type:Object,default:function(){return{}}},projectList:{type:Array,default:function(){return[]}},dataSourceList:{type:Array,default:function(){return[]}}},data:function(){var e=this,t=function(t,a,n){e.formData.projectDicId&&e.formData.dataSourceInfoId?e.formData.id?n():e.$get("/datacenter/metadata/isTaskExists/"+e.formData.projectDicId+"/"+e.formData.dataSourceInfoId).then((function(e){e.data?n():n(new Error("当前数据源对应的项目已存在，不允许创建多个！"))})):n()};return{rules:{name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],projectDicId:[{required:!0,validator:t,trigger:"change"}],dataSourceInfoId:[{required:!0,validator:t,trigger:"change"}]}}},created:function(){},methods:{nexStep:function(){var e=this;this.formData.fetchTableName=!0,this.$refs.form.validate((function(t){t&&e.$emit("nextStep")}))},closeDialog:function(){this.$emit("closeDialog")}}},l=s,o=(a("6682"),a("cba8")),r=Object(o["a"])(l,n,i,!1,null,"0bf03b24",null);t["default"]=r.exports},1046:function(e,t,a){},"3e13":function(e,t,a){"use strict";a("3e76")},"3e76":function(e,t,a){},"4e67":function(e,t,a){"use strict";a("ae49")},"5eb4":function(e,t,a){"use strict";a("1046")},"5f5b":function(e,t,a){},6682:function(e,t,a){"use strict";a("9dca")},"72de":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"el-transfer-panel el-transfer-panel1"},[a("p",{staticClass:"el-transfer-panel__header"},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate,disabled:0===e.listData.length},on:{change:e.changeAll},model:{value:e.allChecked,callback:function(t){e.allChecked=t},expression:"allChecked"}},[e._v(e._s(e.title)),a("span",[e._v(e._s(e.checkPercent))])])],1),a("div",{staticClass:"el-transfer-panel__body1 is-with-footer"},[a("el-input",{staticClass:"el-transfer-panel__filter",attrs:{clearable:"",size:"small",placeholder:"请输入搜索内容","prefix-icon":"el-icon-search"},on:{input:e.filterMatch},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),a("el-checkbox-group",{staticClass:"el-transfer-panel__list1 is-filterable",on:{change:e.checkAll},model:{value:e.checkDatas,callback:function(t){e.checkDatas=t},expression:"checkDatas"}},e._l(e.listData,(function(t,n){return void 0===t.show||t.show?a("el-checkbox",{key:n,staticClass:"el-transfer-panel__item",attrs:{label:n}},[e._v(e._s(t[e.props.name])+"["+e._s(t[e.props.label])+"]")]):e._e()})),1),a("p",{directives:[{name:"show",rawName:"v-show",value:e.noMatch,expression:"noMatch"}],staticClass:"el-transfer-panel__empty"},[e._v("无匹配数据")]),a("p",{directives:[{name:"show",rawName:"v-show",value:0==e.listData.length,expression:"listData.length == 0"}],staticClass:"el-transfer-panel__empty"},[e._v("无数据")])],1),e.showFooter?a("div",{staticClass:"el-transfer-panel__footer"},[e.selectTableRegexVisible?a("el-input",{ref:"selectInput",staticClass:"input-new-tag",attrs:{size:"small",placeholder:"请输入匹配表名的正则"},on:{blur:e.handleSelectInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSelectInputConfirm.apply(null,arguments)}},model:{value:e.selectTableRegexValue,callback:function(t){e.selectTableRegexValue=t},expression:"selectTableRegexValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showSelectInput}},[e._v("+ 正则匹配")]),a("div",{staticClass:"tab-wrap"},e._l(e.tableRegex,(function(t,n){return a("el-tag",{key:t,staticClass:"regTags",attrs:{closable:"",type:t},on:{close:function(t){return e.tableRegex.splice(n,1)}}},[e._v(" "+e._s(t)+" ")])})),1)],1):e._e()])},i=[],s=(a("a9b6"),a("c284"),a("3e22"),{name:"transfer",data:function(){return{filterText:"",checkDatas:[],noMatch:!1,allChecked:!1,selectTableRegexValue:"",selectTableRegexVisible:!1}},props:{title:{type:String,default:""},listData:{type:Array,default:function(){return[]}},props:{type:Object,default:function(){return{label:"tableName",name:"remarks",value:"value"}}},showFooter:{type:Boolean,default:!1},tableRegex:{type:Array,default:function(){return[]}}},computed:{checkPercent:function(){var e=this.listData.length;return 0==e?0:this.checkDatas.length+"/"+e},isIndeterminate:function(){return this.checkDatas.length!=this.listData.length&&this.checkDatas.length>0}},methods:{checkboxChange:function(e){},changeAll:function(e){var t=this;if(this.checkDatas=[],e){var a=0;this.listData.forEach((function(e){t.checkDatas.push(a),a++}))}},checkAll:function(e){this.checkDatas.length===this.listData.length&&this.checkDatas.length>0?this.allChecked=!0:this.allChecked=!1},filterMatch:function(){var e=this;this.filterText?this.listData.forEach((function(t){var a=t[e.props.label]+t[e.props.name];a.indexOf(e.filterText)<0?t.show=!1:t.show=!0})):this.listData.forEach((function(e){e.show=!0}))},handleSelectInputConfirm:function(){var e=this.selectTableRegexValue;e&&this.tableRegex.push(e),this.selectTableRegexVisible=!1,this.selectTableRegexValue=""},showSelectInput:function(){var e=this;this.selectTableRegexVisible=!0,this.$nextTick((function(t){e.$refs.selectInput.$refs.input.focus()}))}},watch:{checkDatas:{handler:function(e,t){this.$emit("disableBtn")}}}}),l=s,o=(a("4e67"),a("cba8")),r=Object(o["a"])(l,n,i,!1,null,"3002123a",null);t["default"]=r.exports},"9dca":function(e,t,a){},ae49:function(e,t,a){},aefa:function(e,t,a){"use strict";a.r(t);var n,i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"formWrapper"},[a("div",{staticClass:"el-transfer",staticStyle:{"text-align":"left",display:"inline-block"}},[a("transfer",{ref:"originTable",attrs:{title:"该数据源的表",listData:e.allTables},on:{disableBtn:e.disableBtn}}),a("div",{staticClass:"el-transfer__buttons"},[a("div",[a("el-button",{staticClass:"el-transfer__button",attrs:{type:"primary",disabled:e.rightBtnDisabled},on:{click:function(t){return e.moveToRight(0)}}},[a("i",{staticClass:"el-icon-arrow-right"})])],1),a("div",[a("el-button",{staticClass:"el-transfer__button",attrs:{type:"primary",disabled:e.leftBtnDisabled},on:{click:e.moveToLeft}},[a("i",{staticClass:"el-icon-arrow-left"})])],1),a("div",[a("el-button",{staticClass:"el-transfer__button",attrs:{type:"primary",disabled:e.rightBtnDisabled},on:{click:function(t){return e.moveToRight(1)}}},[a("i",{staticClass:"el-icon-delete"})])],1)]),a("transfer",{ref:"selectTable",attrs:{title:"已选择表",listData:e.formData.includeTables,tableRegex:e.formData.includeRegex,showFooter:""},on:{disableBtn:e.disableBtn}}),a("div",{staticClass:"el-transfer__buttons"}),a("transfer",{ref:"ignoreTable",attrs:{title:"已忽略表",listData:e.formData.excludeTables,tableRegex:e.formData.excludeRegex,showFooter:""},on:{disableBtn:e.disableBtn}}),a("div",{staticClass:"step-control"},[a("el-button",{staticStyle:{float:"left"},attrs:{type:"primary",icon:"el-icon-arrow-left"},on:{click:e.lastStep}},[e._v("上一步")]),a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.nextStep}},[e._v("下一步"),a("i",{staticClass:"el-icon-arrow-right el-icon--right"})])],1)],1)])},s=[],l=a("724c"),o=(a("6ba1"),a("a9b6"),a("c284"),a("8d1b"),a("72de")),r={name:"taskInfo",components:{transfer:o["default"]},props:{formData:{type:Object,default:function(){return{}}}},data:function(){return{allTables:[],rightBtnDisabled:!0,leftBtnDisabled:!0}},computed:{},created:function(){this.getTables()},methods:(n={lastStep:function(){this.$emit("lastStep")},nextStep:function(){this.$emit("nextStep")},moveToRight:function(e){var t,a=this,n=this.$refs.originTable,i=n.checkDatas;t=e?this.formData.excludeTables:this.formData.includeTables;var s=0;i.sort(),i.forEach((function(e){t.push(a.allTables[e-s]),a.allTables.splice(e-s,1),s++})),this.$refs.originTable.checkDatas=[],n.checkAll()},moveToLeft:function(){var e=this,t=this.$refs.selectTable,a=this.$refs.ignoreTable,n=t.checkDatas,i=a.checkDatas,s=0;n.sort(),i.sort(),n.forEach((function(t){e.allTables.splice(0,0,e.formData.includeTables[t-s]),e.formData.includeTables.splice(t-s,1),s++}));var l=0;i.forEach((function(t){e.allTables.splice(0,0,e.formData.excludeTables[t-l]),e.formData.excludeTables.splice(t-l,1),l++})),t.checkDatas=[],a.checkDatas=[],t.checkAll(),a.checkAll()},disableBtn:function(){if(this.$refs.originTable&&(this.rightBtnDisabled=0===this.$refs.originTable.checkDatas.length),this.$refs.selectTable){var e=this.$refs.selectTable.checkDatas.length+this.$refs.ignoreTable.checkDatas.length;this.leftBtnDisabled=0===e}}},Object(l["a"])(n,"lastStep",(function(){this.formData.includeTables=[],this.formData.includeRegex=[],this.formData.excludeRegex=[],this.formData.excludeTables=[],this.$emit("lastStep")})),Object(l["a"])(n,"nextStep",(function(){this.formData.fetchTableName=!1,this.$emit("nextStep")})),Object(l["a"])(n,"getTables",(function(){var e=this;this.$postJson("/datacenter/metadata/getTableModels",this.formData).then((function(t){e.allTables=t.data,e.formData.includeTables=t.reserveData.includeTables,e.formData.includeRegex=t.reserveData.includeRegex,e.formData.excludeRegex=t.reserveData.excludeRegex,e.formData.excludeTables=t.reserveData.excludeTables}))})),n)},c=r,u=(a("f3a0"),a("cba8")),d=Object(u["a"])(c,i,s,!1,null,"6afce577",null);t["default"]=d.exports},e2de:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"formWrapper"},[a("el-container",[a("el-aside",{staticClass:"table-aside"},[a("el-scrollbar",{ref:"scrollbar",staticStyle:{height:"calc(100vh - 220px)"}},[a("el-input",{staticClass:"el-transfer-panel__filter",attrs:{clearable:"",size:"small",placeholder:"请输入搜索内容","prefix-icon":"el-icon-search"},on:{input:e.filterMatch},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),a("el-menu",{attrs:{defaultActive:e.defaultActive},on:{select:e.selectTable}},[a("transition-group",{attrs:{"enter-active-class":"animate__animated  animate__fadeInDown"}},e._l(e.tableList,(function(t,n){return a("el-menu-item",{directives:[{name:"show",rawName:"v-show",value:void 0===t.show||t.show,expression:"item.show === undefined ? true : item.show"}],key:n+"c",attrs:{index:""+n}},[a("i",{staticClass:"el-icon-s-grid",staticStyle:{color:"#ff0000"}}),void 0!=t.inputVisible&&t.inputVisible?a("el-input",{ref:t.tableName,refInFor:!0,staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:function(a){return e.handleInputConfirm(t)}},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:t.remarks,callback:function(a){e.$set(t,"remarks",a)},expression:"item.remarks"}}):a("span",{attrs:{title:"右击修改表名称"},on:{contextmenu:function(a){return a.preventDefault(),e.showInput(t)}}},[e._v(e._s(t.remarks)+"["+e._s(t.tableName)+"]")])],1)})),1)],1)],1)],1),a("el-container",[a("el-main",{staticClass:"table-content"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),a("el-table-column",{attrs:{prop:"columnName",label:"名称",width:"140"}}),a("el-table-column",{attrs:{prop:"typeName",label:"数据类型",width:"120"}}),a("el-table-column",{attrs:{prop:"columnSize",label:"长度"}}),a("el-table-column",{attrs:{prop:"decimalDigits",label:"精度（小数位）"}}),a("el-table-column",{attrs:{prop:"nullable",label:"允许空值"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(" "+e._s(t.row.nullable)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"primaryKey",label:"主键"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(" "+e._s(t.row.primaryKey)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"columnDef",label:"默认值"}}),a("el-table-column",{attrs:{prop:"remark",label:"说明"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{clearable:""},model:{value:t.row.remarks,callback:function(a){e.$set(t.row,"remarks",a)},expression:"scope.row.remarks"}})]}}])})],1)],1),a("el-footer",[a("div",[a("el-button",{staticStyle:{float:"left"},attrs:{type:"primary",icon:"el-icon-arrow-left"},on:{click:e.lastStep}},[e._v("上一步")]),a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.nextStep}},[e._v("下一步"),a("i",{staticClass:"el-icon-arrow-right el-icon--right"})])],1)])],1)],1)],1)},i=[],s=(a("a9b6"),a("c284"),a("3fab"),a("ed02"),{name:"taskInfo",props:{formData:{type:Object,default:function(){return{}}}},data:function(){return{tableData:[],tableList:[],filterText:"",tableLoading:!1,defaultActive:"0"}},filters:{boolString:function(e){return e||"Y"===e?"Y":"N"}},created:function(){this.getTableList()},mounted:function(){this.handleScroll()},methods:{handleScroll:function(){var e=this,t=this.$refs.scrollbar.wrap;t.onscroll=function(){t.scrollTop>135?e.isFixedTop=!0:e.isFixedTop=!1}},lastStep:function(){this.formData.fetchTableName=!0,this.formData.includeTables=[],this.formData.includeRegex=[],this.formData.excludeRegex=[],this.formData.excludeTables=[],this.$emit("lastStep")},nextStep:function(){this.$emit("nextStep",this.tableList)},filterMatch:function(){var e=this;this.filterText?this.tableList.forEach((function(t){t.remarks.indexOf(e.filterText)>-1||t.tableName.indexOf(e.filterText)>-1?t.show=!0:t.show=!1})):this.tableList.forEach((function(e){e.show=!0}))},selectTable:function(e,t){var a=this;this.tableLoading=!0,setTimeout((function(){a.tableData=a.tableList[e.replace("c","")].columns,a.tableLoading=!1}),1e3)},getTableList:function(){var e=this;this.$postJson("/datacenter/metadata/getTableModels",this.formData).then((function(t){e.tableList=t.data,e.tableList.forEach((function(e){e.inputVisible=!1})),e.tableList.length>0&&(e.tableData=e.tableList[0].columns)}))},handleInputConfirm:function(e){e.inputVisible=!1,this.$forceUpdate()},showInput:function(e){var t=this;e.inputVisible=!0,this.$forceUpdate(),this.$nextTick((function(a){t.$refs[e.tableName][0].$refs.input.focus()}))}}}),l=s,o=(a("3e13"),a("cba8")),r=Object(o["a"])(l,n,i,!1,null,"7256f2c6",null);t["default"]=r.exports},ea8e:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.easyFlowVisible?a("div",{staticStyle:{height:"calc(83vh)"}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"ef-tooltar"},[a("el-link",{attrs:{type:"primary",underline:!1}},[e._v(" "+e._s(e.data.name)+" ")]),a("el-divider",{attrs:{direction:"vertical"}}),a("el-button",{attrs:{type:"text",icon:"el-icon-delete",size:"large",disabled:!this.activeElement.type},on:{click:e.deleteElement}}),a("el-divider",{attrs:{direction:"vertical"}}),a("el-divider",{attrs:{direction:"vertical"}}),a("el-button",{attrs:{type:"text",icon:"el-icon-plus",size:"large"},on:{click:e.zoomAdd}}),a("el-divider",{attrs:{direction:"vertical"}}),a("el-button",{attrs:{type:"text",icon:"el-icon-minus",size:"large"},on:{click:e.zoomSub}}),a("div",{staticStyle:{float:"right","margin-right":"5px"}},[a("el-button",{attrs:{type:"info",plain:"",round:"",icon:"el-icon-back",size:"mini"},on:{click:e.lastStep}},[e._v(" 上一步 ")]),a("el-button",{attrs:{type:"primary",plain:"",round:"",icon:"el-icon-document",size:"mini"},on:{click:e.saveData}},[e._v(" 保存 ")])],1)],1)])],1),a("div",{staticStyle:{display:"flex",height:"calc(100vh - 180px)"}},[a("div",{staticClass:"wrap-menu-lists"},[a("el-scrollbar",{ref:"scrollbarMenu",staticClass:"menu-scrollbar"},[a("node-menu",{ref:"nodeMenu",attrs:{menuList:e.tableList},on:{addNode:e.addNode}})],1)],1),a("div",{directives:[{name:"flowDrag",rawName:"v-flowDrag"}],ref:"efContainer",staticClass:"container",attrs:{id:"efContainer"}},[e._l(e.data.nodeList,(function(t){return[a("flow-node",{key:t.id,attrs:{id:t.id,node:t,activeElement:e.activeElement},on:{changeNodeSite:e.changeNodeSite,nodeRightMenu:e.nodeRightMenu,clickNode:e.clickNode}})]})),a("div",{staticStyle:{position:"absolute",top:"2000px",left:"2000px"}},[e._v(" ")])],2),a("div",{staticStyle:{width:"300px","border-left":"1px solid #dce3e8","background-color":"#FBFBFB"}},[a("flow-node-form",{ref:"nodeForm",on:{setLineLabel:e.setLineLabel,repaintEverything:e.repaintEverything}})],1)]),e.flowInfoVisible?a("flow-info",{ref:"flowInfo",attrs:{data:e.data}}):e._e(),e.flowHelpVisible?a("flow-help",{ref:"flowHelp"}):e._e()],1):e._e()},i=[],s=(a("59d7"),a("a9b6"),a("3bdf"),a("c284"),a("28fd"),a("3e22"),a("16e1"),a("162b"),a("25d5")),l=a.n(s),o=(a("a778"),a("ab70")),r=a("c014"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"tool",staticClass:"flow-menu"},e._l(e.menuList,(function(t){return a("div",{key:t.id},[a("span",{staticClass:"ef-node-pmenu",on:{click:function(a){return e.openMenu(t)}}},[a("i",{class:{"el-icon-caret-bottom":t.open,"el-icon-caret-right":!t.open}}),e._v(" "+e._s(t.name))]),a("ul",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"menu.open"}],staticClass:"ef-node-menu-ul"},[a("draggable",{attrs:{options:e.draggableOptions},on:{end:e.end,start:e.move},model:{value:t.children,callback:function(a){e.$set(t,"children",a)},expression:"menu.children"}},e._l(t.children,(function(t){return a("li",{key:t.id,staticClass:"ef-node-menu-li",attrs:{title:t.type,type:t.type}},[e._v(" "+e._s(t.name)+" ")])})),0)],1)])})),0)},u=[],d={left:-1,top:-1},f={props:{menuList:{type:Array,default:function(){return[]}}},data:function(){return{activeNames:"1",draggableOptions:{preventOnFilter:!1,sort:!1,disabled:!1,ghostClass:"tt",forceFallback:!0},defaultOpeneds:[],nodeMenu:{}}},components:{draggable:l.a},created:function(){this.isFirefox()&&(document.body.ondrop=function(e){d.left=e.layerX,d.top=e.clientY-50,e.preventDefault(),e.stopPropagation()})},methods:{getMenuByType:function(e){for(var t=0;t<this.menuList.length;t++)for(var a=this.menuList[t].children,n=0;n<a.length;n++)if(a[n].type===e)return a[n]},move:function(e,t,a,n){var i=e.item.attributes.type.nodeValue;this.nodeMenu=this.getMenuByType(i)},end:function(e,t){this.$emit("addNode",e,this.nodeMenu,d)},isFirefox:function(){var e=navigator.userAgent;return e.indexOf("Firefox")>-1},openMenu:function(e){e.open=!e.open,this.$forceUpdate()}}},m=f,h=a("cba8"),p=Object(h["a"])(m,c,u,!1,null,null,null),b=p.exports,g=a("1ce7"),v=a("a837"),x=a("f779"),D=a("7c98"),k=a.n(D),y={props:{dataList:{type:Array,default:function(){return[]}},formData:{type:Object,default:function(){return{}}}},computed:{tableList:function(){var e=this,t=this.dataList.map((function(t,a){return{id:a,type:t.tableName+"#"+e.formData.dataSourceInfoId,name:t.remarks?t.remarks:t.tableName,ico:"fa fa-arrows",style:{}}})),a={id:"1",type:"group",name:"表节点",ico:"el-icon-video-play",open:!0,children:t};return[a]}},data:function(){return{jsPlumb:null,easyFlowVisible:!0,flowInfoVisible:!1,loadEasyFlowFinish:!1,flowHelpVisible:!1,activeElement:{type:void 0,nodeId:void 0,sourceId:void 0,targetId:void 0},data:{nodeList:[],lineList:[]},zoom:.5}},mixins:[o["a"]],components:{draggable:l.a,flowNode:r["a"],nodeMenu:b,FlowInfo:g["a"],FlowNodeForm:x["a"],FlowHelp:v["a"]},directives:{flowDrag:{bind:function(e,t,a,n){t&&(e.onmousedown=function(t){if(2!=t.button){var a=t.clientX,n=t.clientY;e.style.cursor="move",document.onmousemove=function(t){t.preventDefault();var i=t.clientX-a;a=t.clientX,e.scrollLeft+=-i;var s=t.clientY-n;n=t.clientY,e.scrollTop+=-s},document.onmouseup=function(t){e.style.cursor="auto",document.onmousemove=null,document.onmouseup=null}}})}}},mounted:function(){this.jsPlumb=jsPlumb.getInstance(),this.getRelation()},methods:{getUUID:function(){return Math.random().toString(36).substr(3,10)},jsPlumbInit:function(){var e=this;this.jsPlumb.ready((function(){e.jsPlumb.importDefaults(e.jsplumbSetting),e.jsPlumb.setSuspendDrawing(!1,!0),e.loadEasyFlow(),e.jsPlumb.bind("click",(function(t,a){e.activeElement.type="line",e.activeElement.sourceId=t.sourceId,e.activeElement.targetId=t.targetId,e.$refs.nodeForm.lineInit({from:t.sourceId,to:t.targetId,label:t.getLabel()})})),e.jsPlumb.bind("connection",(function(t){var a=t.source.id,n=t.target.id;e.loadEasyFlowFinish&&e.data.lineList.push({from:a,to:n})})),e.jsPlumb.bind("connectionDetached",(function(t){e.deleteLine(t.sourceId,t.targetId)})),e.jsPlumb.bind("connectionMoved",(function(t){e.changeLine(t.originalSourceId,t.originalTargetId)})),e.jsPlumb.bind("contextmenu",(function(e){console.log("contextmenu",e)})),e.jsPlumb.bind("beforeDrop",(function(t){var a=t.sourceId,n=t.targetId;return a===n?(e.$message.error("节点不支持连接自己"),!1):e.hasLine(a,n)?(e.$message.error("该关系已存在,不允许重复创建"),!1):e.hashOppositeLine(a,n)?(e.$message.error("不支持两个节点之间连线回环"),!1):(e.$message.success("连接成功"),!0)})),e.jsPlumb.bind("beforeDetach",(function(e){console.log("beforeDetach",e)})),e.jsPlumb.setContainer(e.$refs.efContainer)}))},loadEasyFlow:function(){for(var e=0;e<this.data.nodeList.length;e++){var t=this.data.nodeList[e];this.jsPlumb.makeSource(t.id,k.a.merge(this.jsplumbSourceOptions,{})),this.jsPlumb.makeTarget(t.id,this.jsplumbTargetOptions),t.viewOnly||this.jsPlumb.draggable(t.id,{containment:"parent",stop:function(e){console.log("拖拽结束: ",e)}})}for(e=0;e<this.data.lineList.length;e++){var a=this.data.lineList[e],n={source:a.from,target:a.to,label:a.label?a.label:"",connector:a.connector?a.connector:"",anchors:a.anchors?a.anchors:void 0,paintStyle:a.paintStyle?a.paintStyle:void 0};this.jsPlumb.connect(n,this.jsplumbConnectOptions)}this.$nextTick((function(){this.loadEasyFlowFinish=!0}))},setLineLabel:function(e,t,a){var n=this.jsPlumb.getConnections({source:e,target:t})[0];a&&""!==a?n.addClass("flowLabel"):(n.removeClass("flowLabel"),n.addClass("emptyFlowLabel")),n.setLabel({label:a}),this.data.lineList.forEach((function(n){n.from==e&&n.to==t&&(n.label=a)}))},deleteElement:function(){var e=this;"node"===this.activeElement.type?this.deleteNode(this.activeElement.nodeId):"line"===this.activeElement.type&&this.$confirm("确定删除所点击的线吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=e.jsPlumb.getConnections({source:e.activeElement.sourceId,target:e.activeElement.targetId})[0];e.jsPlumb.deleteConnection(t)})).catch((function(){}))},deleteLine:function(e,t){this.data.lineList=this.data.lineList.filter((function(a){return a.from!=e||a.to!=t})),this.activeElement.type="",this.activeElement.nodeId="",this.$refs.nodeForm.node={}},changeLine:function(e,t){this.deleteLine(e,t)},changeNodeSite:function(e){for(var t=0;t<this.data.nodeList.length;t++){var a=this.data.nodeList[t];a.id===e.nodeId&&(a.left=e.left,a.top=e.top)}},addNode:function(e,t,a){var n=e.originalEvent.clientX,i=e.originalEvent.clientY,s=this.$refs.efContainer,l=s.getBoundingClientRect(),o=n,r=i;if(o<l.x||o>l.width+l.x||r<l.y||l.y>l.y+l.height)this.$message.error("请把节点拖入到画布中");else{o=o-l.x+s.scrollLeft,r=r-l.y+s.scrollTop,o-=85,r-=16;var c=t.type,u=this.data.nodeList.filter((function(e){return e.type===t.type}));if(u.length>0)this.$message.error("该节点已存在画布中！");else{var d={id:c,name:t.name,type:c,left:o+"px",top:r+"px",ico:t.ico,state:"success"};this.data.nodeList.push(d),this.$nextTick((function(){this.jsPlumb.makeSource(c,this.jsplumbSourceOptions),this.jsPlumb.makeTarget(c,this.jsplumbTargetOptions),this.jsPlumb.draggable(c,{containment:"parent",stop:function(e){console.log("拖拽结束: ",e)}})}))}}},deleteNode:function(e){var t=this;return this.$confirm("确定要删除所选节点","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){t.data.nodeList=t.data.nodeList.filter((function(t){return t.id!==e})),t.$nextTick((function(){this.jsPlumb.removeAllEndpoints(e)})),t.activeElement.type="",t.activeElement.nodeId="",t.$refs.nodeForm.node={}})).catch((function(){})),!0},clickNode:function(e){this.activeElement.type="node",this.activeElement.nodeId=e,this.$refs.nodeForm.nodeInit(this.data,e)},hasLine:function(e,t){for(var a=0;a<this.data.lineList.length;a++){var n=this.data.lineList[a];if(n.from===e&&n.to===t)return!0}return!1},hashOppositeLine:function(e,t){return this.hasLine(t,e)},nodeRightMenu:function(e,t){this.menu.show=!0,this.menu.curNodeId=e,this.menu.left=t.x+"px",this.menu.top=t.y+"px"},repaintEverything:function(){this.jsPlumb.repaint()},dataInfo:function(){this.flowInfoVisible=!0,this.$nextTick((function(){this.$refs.flowInfo.init()}))},dataReload:function(){var e=this;this.easyFlowVisible=!1,this.$nextTick((function(){e.easyFlowVisible=!0,e.$nextTick((function(){e.jsPlumb=jsPlumb.getInstance(),e.$nextTick((function(){e.jsPlumbInit()}))}))}))},zoomAdd:function(){this.zoom>=1||(this.zoom=this.zoom+.1,this.$refs.efContainer.style.transform="scale(".concat(this.zoom,")"),this.jsPlumb.setZoom(this.zoom))},zoomSub:function(){this.zoom<=0||(this.zoom=this.zoom-.1,this.$refs.efContainer.style.transform="scale(".concat(this.zoom,")"),this.jsPlumb.setZoom(this.zoom))},downloadData:function(){var e=this;this.$confirm("确定要下载该流程数据吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){var t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e.data,null,"\t")),a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("download","data.json"),a.click(),a.remove(),e.$message.success("正在下载中,请稍后...")})).catch((function(){}))},openHelp:function(){this.flowHelpVisible=!0,this.$nextTick((function(){this.$refs.flowHelp.init()}))},lastStep:function(){this.$emit("lastStep")},saveData:function(){var e=this;this.formData.tableRelation=this.data,this.formData.tableInfo=this.dataList,this.$postJson("/datacenter/metadata/saveTaskInfo",this.formData).then((function(t){1===t.code&&(e.$message.success(t.msg),e.$emit("closeDialog"))}))},getRelation:function(){var e=this;this.formData.projectDicId&&this.$get("/datacenter/metadata/getEasyFlowTableRelation/"+this.formData.projectDicId).then((function(t){1===t.code&&(e.data.nodeList=t.data.nodeList,e.data.lineList=t.data.lineList,e.dataReload())}))}}},T=y,w=(a("5eb4"),Object(h["a"])(T,n,i,!1,null,null,null));t["default"]=w.exports},ef54:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("d2-container",[a("div",{staticClass:"search-area"},[a("el-form",{attrs:{inline:!0,model:e.search}},[a("el-form-item",{attrs:{label:"任务名称"}},[a("el-input",{model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"所属项目"}},[a("el-select",{attrs:{placeholder:"请选择所属项目"},model:{value:e.search.projectDicId,callback:function(t){e.$set(e.search,"projectDicId",t)},expression:"search.projectDicId"}},e._l(e.projectList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.value}},[e._v(e._s(t.name))])})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getList}},[e._v("查询")])],1)],1)],1),a("div",{staticClass:"btn-area"},[a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.showForm}},[e._v("新建任务")])],1),a("div",{staticClass:"table-area"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),a("el-table-column",{attrs:{prop:"name",label:"任务名称"}}),a("el-table-column",{attrs:{prop:"projectDicIdStr",label:"所属项目"}}),a("el-table-column",{attrs:{prop:"dataSourceName",label:"所属数据源"}}),a("el-table-column",{attrs:{prop:"isTask",label:"是否参与调度"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(" "+e._s(e._f("boolString")(t.row.isTask))+" ")])]}}])}),a("el-table-column",{attrs:{prop:"remark",label:"描述"}}),a("el-table-column",{attrs:{prop:"updateTime",label:"最近一次执行时间"}}),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),a("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.editData(t.row)}}},[e._v("配置 ")]),1===t.row.isTask?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.executeNow(t.row)}}},[e._v("立即执行 ")]):e._e(),0===t.row.isTask?a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){return e.enableTask(t.row)}}},[e._v("开启任务 ")]):e._e()]}}])})],1),a("div",{staticClass:"el-page"},[a("el-pagination",{attrs:{"current-page":e.pager.currentPage,"page-sizes":e.pageSizes,"page-size":e.pager.pageSize,layout:e.pagerSetting,total:e.pager.totalCount},on:{"size-change":e.handlePageSizeChange,"current-change":e.handleCurrentChange}})],1)],1),a("el-dialog",{attrs:{title:"任务配置",visible:e.dialogFormVisible,fullscreen:""},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-steps",{attrs:{active:e.step,simple:"","finish-status":"success"}},[a("el-step",{attrs:{title:"填写相关信息",icon:"el-icon-edit-outline"}}),a("el-step",{attrs:{title:"选择元数据表",icon:"el-icon-scissors"}}),a("el-step",{attrs:{title:"确认元数据属性",icon:"el-icon-check"}}),a("el-step",{attrs:{title:"建立数据血缘关系",icon:"el-icon-check"}})],1),a("transition",{attrs:{name:e.animationMode,mode:"out-in"}},[0==e.step?a("div",[a("task-info",{attrs:{"project-list":e.projectList,dataSourceList:e.dataSourceList,formData:e.formData},on:{nextStep:e.nextStep,lastStep:e.lastStep,closeDialog:e.closeDialog}})],1):e._e()]),a("transition",{attrs:{name:e.animationMode,mode:"out-in"}},[1==e.step?a("div",[a("select-grid",{attrs:{formData:e.formData},on:{nextStep:e.nextStep,lastStep:e.lastStep}})],1):e._e()]),a("transition",{attrs:{name:e.animationMode,mode:"out-in"}},[2==e.step?a("div",[a("confirm-meta",{attrs:{formData:e.formData},on:{nextStep:e.nextStep,lastStep:e.lastStep}})],1):e._e()]),a("transition",{attrs:{name:e.animationMode,mode:"out-in"}},[3==e.step?a("div",[a("table-relation",{attrs:{dataList:e.globalData,formData:e.formData},on:{closeDialog:e.closeDialog,lastStep:e.lastStep}})],1):e._e()])],1)],1)},i=[],s=(a("3fab"),a("814e"),a("3e22"),a("0f7b")),l=a("aefa"),o=a("e2de"),r=a("ea8e"),c={name:"task-setting",components:{taskInfo:s["default"],selectGrid:l["default"],confirmMeta:o["default"],tableRelation:r["default"]},data:function(){return{animationMode:"my-slide",search:{name:"",projectDicId:""},projectList:[],dataSourceList:[],formData:{id:"",name:"",projectDicId:"",dataSourceInfoId:"",inStrategy:0,isTask:0,remark:"",includeRegex:[],excludeTables:[],excludeRegex:[],fetchTableName:!1,includeTables:[]},pager:{totalCount:0,pageCount:1,pageSize:10,currentPage:1},pageSizes:[10,20,40,60,100],pagerSetting:"total, sizes, prev, pager, next, jumper",tableData:[],listLoading:!1,dialogTitle:"",newDataTitle:"新建任务",editDataTitle:"查看任务",dialogFormVisible:!1,listPath:"/datacenter/metadata/taskInfoPageList",savePath:"",deletePath:"",step:0,nextBol:!0,globalData:[]}},filters:{boolString:function(e){return e?"是":"否"},inStrategyStr:function(e){return e?"全量":"增量"}},watch:{},created:function(){this.getList(),this.getProject(),this.getDataSource()},methods:{getList:function(e){var t=this;this.listLoading=!0,e&&(this.pager.currentPage=1);var a=Object.assign({},this.search,{pageSize:this.pager.pageSize,currentPage:this.pager.currentPage});this.$get(this.listPath,a).then((function(e){t.listLoading=!1,1===e.code&&(t.tableData=e.data.list,t.pager.totalCount=e.data.totalCount,t.pager.pageCount=e.data.pageCount,t.pager.pageSize=e.data.pageSize,t.pager.currentPage=e.data.currentPage)})).catch((function(e){t.listLoading=!1}))},showForm:function(){this.step=0,this.dialogTitle=this.newDataTitle,this.formData={id:"",name:"",projectDicId:"",dataSourceInfoId:"",inStrategy:0,isTask:0,remark:"",includeRegex:[],excludeRegex:[],excludeTables:[],includeTables:[]},this.dialogFormVisible=!0},saveForm:function(){var e=this;this.$refs.form.validate((function(t,a){t?(e.$post(e.savePath,e.formData).then((function(t){1===t.code&&e.$message.success(t.msg)})),e.dialogFormVisible=!1):e.$message({message:"请完善相关信息填写！",type:"warning"})}))},editData:function(e){this.step=0,this.dialogTitle=this.editDataTitle,this.formData={id:e.id,name:e.name,projectDicId:e.projectDicId,dataSourceInfoId:e.dataSourceInfoId,inStrategy:e.inStrategy,isTask:e.isTask,remark:e.remark,includeRegex:e.includeRegex,excludeTables:e.excludeTables,excludeRegex:e.excludeRegex,fetchTableName:!1,includeTables:[]},this.dialogFormVisible=!0},executeNow:function(e){var t=this;this.$get("/datacenter/metadata/executeTask",{id:e.id}).then((function(e){1===e.code&&t.$message.success("成功")}))},deleteData:function(e){var t=this;this.$confirm("确定删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$get(t.deletePath+"/"+e.id).then((function(e){1===e.code&&(t.$message({message:"删除成功！",type:"success"}),t.getList(!0))}))}))},resetQuery:function(){this.search={},this.getList(!0)},handleCurrentChange:function(e){this.pager.currentPage=e,this.getList()},handlePageSizeChange:function(e){this.pager.pageSize=e,this.getList(!0)},nextStep:function(e){var t=this;this.animationMode="my-slide",setTimeout((function(){t.step=t.step+1})),e&&(this.globalData=e)},lastStep:function(){var e=this;this.animationMode="my-slide-out",setTimeout((function(){e.step=e.step-1}))},getProject:function(){var e=this;this.$get("/dic/selectList/boshi_project").then((function(t){1===t.code&&(e.projectList=t.data)}))},closeDialog:function(){this.dialogFormVisible=!1,this.getList(!0)},getDataSource:function(){var e=this;this.$get("/datacenter/metadata/dataSourcePageList",{pagseSize:100,currentPage:1}).then((function(t){1===t.code&&(e.dataSourceList=t.data.list)}))},enableTask:function(e){var t=this;this.formData=e,this.formData.isTask=1,this.$postJson("/datacenter/metadata/saveBaseTaskInfo",this.formData).then((function(e){1===e.code&&(t.$message.success(e.msg),t.getList())}))}}},u=c,d=(a("f35c"),a("cba8")),f=Object(d["a"])(u,n,i,!1,null,"53e5a188",null);t["default"]=f.exports},f35c:function(e,t,a){"use strict";a("5f5b")},f3a0:function(e,t,a){"use strict";a("0dd7")}}]);