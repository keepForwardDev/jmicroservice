(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6c6ecf0f","chunk-58724276"],{1884:function(e,t,i){},1889:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("d2-container",[i("SearchBar",{attrs:{searchList:e.searchList,searchData:e.search},on:{getList:e.getList}}),i("div",{staticClass:"btn-area"},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.showForm}},[e._v("新建")])],1),i("CommonTable",{attrs:{tableData:e.tableData,tableLoading:e.tableLoading,tableHeader:e.tableHeader},scopedSlots:e._u([{key:"operate",fn:function(t){var a=t.row;return[i("TableOperation",{attrs:{"operation-list":e.tableOperationList(a)}})]}}])}),i("div",{staticClass:"el-page"},[i("el-pagination",{attrs:{"current-page":e.pager.currentPage,"page-sizes":e.pageSizes,"page-size":e.pager.pageSize,layout:e.pagerSetting,total:e.pager.totalCount},on:{"size-change":e.handlePageSizeChange,"current-change":e.handleCurrentChange}})],1),i("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogFormVisible,"custom-class":"edit-message",width:"680px"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[e.dialogFormVisible?i("CommonForm",{ref:"form",attrs:{"form-data":e.formData,"form-rules":e.formRules,formSettingInfo:e.formSettingInfo}}):e._e(),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.saveForm}},[e._v("保存")])],1)],1),i("privileges-component",{ref:"privilegeRef",attrs:{privileges:e.privileges,drawerTitle:e.drawerTitle,apiResources:e.apiResources}}),i("privileges-view",{ref:"privilegeViewRef",attrs:{showTab:[1],privileges:e.privileges,apiResources:e.apiResources}})],1)},r=[],s=(i("3107"),i("3fab"),i("814e"),i("28fd"),i("a9b6"),i("ce2e")),l=i("684a"),n=i("93f6"),o=i("b504"),c=i("5135"),p=i("0777"),u=i("b13a"),d={name:"admin-clients",components:{privilegesComponent:c["default"],privilegesView:u["default"],SearchBar:s["a"],CommonTable:l["a"],TableOperation:n["a"],CommonForm:o["a"]},data:function(){var e=function(e,t,i){t.startsWith("http")?i():i(new Error("请输入正确的URL回调"))};return{searchList:[{key:"clientName",name:"应用名称",type:"input"},{key:"clientId",name:"app_key",type:"input"},{key:"status",name:"审核状态",type:"select",optionKey:"statusList"}],tableHeader:[{prop:"clientName",label:"应用名称"},{prop:"clientId",label:"app_key"},{prop:"createUserName",label:"所属用户"},{prop:"remarks",label:"备注"},{prop:"webServerRedirectUri",label:"回调地址"},{prop:"deleted",label:"启用状态",html:!0,formatter:function(e){return e?"<span style='color: red'>禁用</span>":"<span style='color: #a4cc05'>启用</span>"}},{prop:"status",label:"审核状态",html:!0,formatter:function(e){return 0===e?"<span style='color: #e6a23c'>待审核</span>":1===e?"<span style='color: #a4cc05'>已通过</span>":2===e?"<span style='color: red'>未通过</span>":""}}],search:{},formSettingInfo:[{key:"clientName",name:"应用名称",type:"input"},{key:"webServerRedirectUri",name:"回调地址",type:"input"},{key:"roleIds",name:"权限角色模板",type:"select",optionList:[],multiple:!0},{key:"status",name:"审核状态",type:"select",optionKey:"statusList"},{key:"deleted",name:"是否启用",type:"select",optionKey:"deletedList"},{key:"remarks",name:"备注",type:"input"}],formData:{id:"",clientName:"",webServerRedirectUri:"",remarks:"",status:1,deleted:0,roleIds:[]},formRules:{clientName:Object(p["b"])(),webServerRedirectUri:[{required:!0,message:"该项为必填项，请填写完整",trigger:"blur"},{validator:e,trigger:"blur"}]},pager:{totalCount:0,pageCount:1,pageSize:10,currentPage:1},pageSizes:[10,20,40,60,100],pagerSetting:"total, sizes, prev, pager, next, jumper",tableData:[],tableLoading:!1,dialogTitle:"",newDataTitle:"新建应用",editDataTitle:"修改应用",dialogFormVisible:!1,listPath:"/admin/clientDetails/pageList",savePath:"/admin/clientDetails/save",deletePath:"/admin/clientDetails/delete",roleList:[],statusList:["待审核","已通过","未通过"],drawerTitle:"",privileges:{resourceIds:[],apiConfig:[],id:"",resourceType:0,privilegeType:2,serviceId:""},apiResources:[]}},filters:{statusString:function(e){return 0===e?"待审核":1===e?"已通过":2===e?"未通过":void 0},enableString:function(e){return e?"禁用":"启用"}},created:function(){this.getList(),this.getApiResource(),this.getRoleList()},methods:{getList:function(e){var t=this;this.tableLoading=!0,e&&(this.pager.currentPage=1);var i=Object.assign({},this.search,{pageSize:this.pager.pageSize,currentPage:this.pager.currentPage});this.$get(this.listPath,i).then((function(e){t.tableLoading=!1,1===e.code&&(t.tableData=e.data.list,t.pager.totalCount=e.data.totalCount,t.pager.pageCount=e.data.pageCount,t.pager.pageSize=e.data.pageSize,t.pager.currentPage=e.data.currentPage)})).catch((function(e){t.tableLoading=!1}))},tableOperationList:function(e){var t=this;return[{type:"primary",label:"编辑",operation:function(){t.editData(e)},disabled:!1,available:!0},{type:"danger",label:"删除",operation:function(){t.deleteData(e)},disabled:!1,available:!0},{label:"授权API",operation:function(){t.grant(e,1)},disabled:!1,available:!0},{label:"权限预览",operation:function(){t.viewPrivileges(e)},disabled:!1,available:!0}].filter((function(e){return e.available}))},showForm:function(){this.dialogTitle=this.newDataTitle,this.formData={id:"",clientName:"",webServerRedirectUri:"",remarks:"",status:1,deleted:0,roleIds:[]},this.dialogFormVisible=!0},saveForm:function(){var e=this,t=this.$refs.form.validForm();t&&(this.$post(this.savePath,this.formData).then((function(t){1===t.code&&(e.$message.success(t.msg),e.getList(!0))})),this.dialogFormVisible=!1)},editData:function(e){this.step=0,this.dialogTitle=this.editDataTitle,this.formData={id:e.id,clientName:e.clientName,webServerRedirectUri:e.webServerRedirectUri,remarks:e.remarks,status:e.status,deleted:e.deleted,roleIds:e.roleIds},this.dialogFormVisible=!0},deleteData:function(e){var t=this;this.$confirm("确定删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$get(t.deletePath+"/"+e.id).then((function(e){1===e.code&&(t.$message({message:"删除成功！",type:"success"}),t.getList(!0))}))}))},resetQuery:function(){this.search={},this.getList(!0)},handleCurrentChange:function(e){this.pager.currentPage=e,this.getList()},handlePageSizeChange:function(e){this.pager.pageSize=e,this.getList(!0)},grant:function(e,t){var i=this;this.privileges.resourceType=t,this.privileges.id=e.id,0===t?(this.drawerTitle=e.clientName+"菜单权限",this.privileges.serviceId=""):1===t?(this.drawerTitle=e.clientName+"API权限",this.apiResources.length>0&&(this.privileges.serviceId=this.apiResources[0].url)):(this.drawerTitle=e.clientName+"自定义权限",this.privileges.serviceId=""),this.$refs.privilegeRef.showDrawer(),this.$nextTick((function(){i.$refs.privilegeRef.getPrivileges()}))},getApiResource:function(){var e=this;this.$get("/apiResources").then((function(t){e.apiResources=t}))},getRoleList:function(){var e=this;this.$get("/admin/role/labelNodes").then((function(t){1===t.code&&(e.formSettingInfo.filter((function(e){return"roleIds"===e.key}))[0].optionList=t.data)}))},viewPrivileges:function(e){this.privileges.id=e.id,this.$refs.privilegeViewRef.show()}}},f=d,g=(i("8cd4"),i("cba8")),m=Object(g["a"])(f,a,r,!1,null,"931d9a32",null);t["default"]=m.exports},"1df3":function(e,t,i){},"29b5":function(e,t,i){},5135:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-drawer",{attrs:{title:e.drawerTitle,visible:e.drawerVisible,direction:"rtl",size:"30%","before-close":e.handleDrawerClose},on:{"update:visible":function(t){e.drawerVisible=t}}},[i("el-scrollbar",{staticClass:"drawer-scrollbar",staticStyle:{height:"calc(100vh - 150px)"}},[i("div",{staticClass:"drawer-content"},[1===e.privileges.resourceType?i("div",{staticClass:"drawer-item"},[e._v(" 服务名称： "),i("el-select",{on:{change:e.changeService},model:{value:e.privileges.serviceId,callback:function(t){e.$set(e.privileges,"serviceId",t)},expression:"privileges.serviceId"}},e._l(e.apiResources,(function(e){return i("el-option",{key:e.url,attrs:{label:e.name,value:e.url}})})),1)],1):e._e(),i("div",{staticClass:"drawer-item"},[i("el-tree",{ref:"treeBox",attrs:{"default-expand-all":"","empty-text":"当前暂无数据","show-checkbox":"","node-key":"id",data:e.treeList},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return i("span",{staticClass:"custom-tree-node"},[i("span",{staticClass:"tree-title",attrs:{title:a.extra}},[e._v(e._s(a.label))]),1===e.privileges.resourceType?i("i",{staticClass:"el-icon-edit-outline closeBtn",attrs:{title:"修改api调用次数"},on:{click:function(t){return e.editLimit(a)}}}):e._e()])}}])})],1)])]),i("div",{staticClass:"drawer-footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.savePrivileges}},[e._v("保存")])],1)],1),i("el-dialog",{attrs:{title:"api调用限制",visible:e.dialogFormVisible1,width:"500px"},on:{"update:visible":function(t){e.dialogFormVisible1=t}}},[i("el-form",{ref:"form1",attrs:{model:e.formData1,"label-width":"120px",rules:e.formRules1}},[i("el-form-item",{attrs:{label:"api调用路径"}},[i("span",[e._v(e._s(e.formData1.apiPath))])]),i("el-form-item",{attrs:{label:"调用次数",prop:"apiLimit"}},[i("el-input",{attrs:{type:"number"},model:{value:e.formData1.apiLimit,callback:function(t){e.$set(e.formData1,"apiLimit",t)},expression:"formData1.apiLimit"}})],1),i("el-form-item",{attrs:{label:"调用策略"}},[i("el-select",{model:{value:e.formData1.apiLimitStrategy,callback:function(t){e.$set(e.formData1,"apiLimitStrategy",t)},expression:"formData1.apiLimitStrategy"}},[i("el-option",{attrs:{label:"次数",value:0}}),i("el-option",{attrs:{label:"每天",value:1}})],1)],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible1=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.saveForm1}},[e._v("确定")])],1)],1)],1)},r=[],s=i("efbe"),l=(i("a9b6"),i("c284"),i("44ad"),i("0777")),n={name:"privileges",data:function(){return{treeList:[],dialogFormVisible1:!1,drawerVisible:!1,formData1:{apiPath:"",apiLimit:"",apiLimitStrategy:0},editNode:{},formRules1:{apiLimit:Object(l["b"])()}}},props:{drawerTitle:{type:String,default:""},privileges:{type:Object,default:function(){return{resourceIds:[],apiConfig:[],id:"",resourceType:0,privilegeType:1,serviceId:""}}},apiResources:{type:Array,default:function(){return[]}},menuTreeList:{type:Array,default:function(){return[]}},resourceTreeList:{type:Array,default:function(){return[]}}},mounted:function(){},methods:{changeService:function(e){this.getPrivileges()},handleDrawerClose:function(e){e()},savePrivileges:function(){var e=this,t=this.$refs.treeBox.getCheckedNodes(),i=this.$refs.treeBox.getCheckedKeys(),a=this.$refs.treeBox.getHalfCheckedKeys(),r=[];1===this.privileges.resourceType?(t.forEach((function(e){e.children||r.push({apiPath:e.data.apiPath,apiLimit:e.data.apiLimit,apiLimitStrategy:e.data.apiLimitStrategy})})),this.privileges.resourceIds=[],this.privileges.apiConfig=r):this.privileges.resourceIds=[].concat(Object(s["a"])(i),Object(s["a"])(a)),this.$postJson("/admin/privilege/savePrivileges",this.privileges).then((function(t){1===t.code&&e.$message.success(t.msg)}))},getPrivileges:function(){var e=this;this.$get("/admin/privilege/getPrivileges",{resourceType:this.privileges.resourceType,id:this.privileges.id,privilegeType:this.privileges.privilegeType,serviceId:this.privileges.serviceId}).then((function(t){1===t.code&&(0===e.privileges.resourceType?e.treeList=e.menuTreeList:1===e.privileges.resourceType?(e.treeList=t.data.apiTree,e.privileges.apiConfig=t.data.apiConfig):e.treeList=e.resourceTreeList,e.$nextTick((function(){t.data.resourceIds.forEach((function(t){e.$refs.treeBox.setChecked(t,!0,!1)}))})))}))},editLimit:function(e){this.dialogFormVisible1=!0,this.editNode=e,this.formData1.apiPath=e.data.apiPath,this.formData1.apiLimit=e.data.apiLimit,this.formData1.apiLimitStrategy=e.data.apiLimitStrategy},saveForm1:function(){var e=this;this.$refs.form1.validate((function(t,i){t?(e.editNode.data.apiPath=e.formData1.apiPath,e.editNode.data.apiLimit=e.formData1.apiLimit,e.editNode.data.apiLimitStrategy=e.formData1.apiLimitStrategy,e.dialogFormVisible1=!1):e.$message({message:"请完善相关信息填写！",type:"warning"})}))},showDrawer:function(){this.drawerVisible=!0}}},o=n,c=(i("5b92"),i("cba8")),p=Object(c["a"])(o,a,r,!1,null,"2f6772dc",null);t["default"]=p.exports},"5b92":function(e,t,i){"use strict";i("29b5")},"8cd4":function(e,t,i){"use strict";i("1df3")},"9bb2":function(e,t,i){"use strict";i("1884")},b13a:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-drawer",{attrs:{title:"权限预览",visible:e.drawerVisible,direction:"rtl",size:"30%","before-close":e.handleDrawerClose},on:{"update:visible":function(t){e.drawerVisible=t}}},[i("div",{staticClass:"drawer-content"},[i("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[e.tabVisible(0)?i("el-tab-pane",{attrs:{label:"菜单",name:"0"}},[i("el-tree",{ref:"menuTree",attrs:{"default-expand-all":"","empty-text":"当前暂无数据","show-checkbox":"","node-key":"id",data:e.menuTreeList},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return i("span",{staticClass:"custom-tree-node"},[i("span",{staticClass:"tree-title",attrs:{title:a.extra}},[e._v(e._s(a.label))])])}}],null,!1,3837425455)})],1):e._e(),e.tabVisible(1)?i("el-tab-pane",{attrs:{label:"API",name:"1"}},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.apiList}},[i("el-table-column",{attrs:{prop:"apiPath",label:"请求路径","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"apiLimit",label:"调用次数限制"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e._f("apiLimitFormat")(t.row.apiLimit)))])]}}],null,!1,3719255644)}),i("el-table-column",{attrs:{prop:"apiLimitStrategy",label:"限制策略"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e._f("apiLimitStrategyFormat")(t.row.apiLimitStrategy)))])]}}],null,!1,366319484)}),i("el-table-column",{attrs:{prop:"serviceId",label:"所属服务"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.getServiceName(t.row.serviceId)))])]}}],null,!1,3493601723)})],1)],1):e._e(),e.tabVisible(2)?i("el-tab-pane",{attrs:{label:"自定义",name:"2"}},[i("el-tree",{ref:"resourceTree",attrs:{"default-expand-all":"","empty-text":"当前暂无数据","show-checkbox":"","node-key":"id",data:e.resourceTreeList},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return i("span",{staticClass:"custom-tree-node"},[i("span",{staticClass:"tree-title",attrs:{title:a.extra}},[e._v(e._s(a.label))])])}}],null,!1,3837425455)})],1):e._e()],1)],1)])],1)},r=[],s=(i("a9b6"),i("c284"),i("28fd"),i("3e22"),{name:"privileges-view",data:function(){return{drawerVisible:!1,activeName:"0",apiTreeList:[],apiList:[],listLoading:!1}},props:{privileges:{type:Object,default:function(){return{resourceIds:[],apiConfig:[],id:"",resourceType:0,privilegeType:0,serviceId:""}}},apiResources:{type:Array,default:function(){return[]}},menuTreeList:{type:Array,default:function(){return[]}},resourceTreeList:{type:Array,default:function(){return[]}},showTab:{type:Array,default:function(){return[0,1,2]}}},created:function(){},filters:{apiLimitFormat:function(e){return 2147483647===e?"无限制":e},apiLimitStrategyFormat:function(e){return e?"每天":"次数"}},methods:{handleDrawerClose:function(e){e()},handleClick:function(e,t){this.privileges.resourceType=this.activeName,this.getPrivileges()},show:function(){this.privileges.resourceType=this.showTab[0],this.activeName=this.showTab[0]+"",this.privileges.serviceId="",this.drawerVisible=!0,this.getPrivileges()},changeService:function(){this.getPrivileges()},getPrivileges:function(){var e=this;this.$get("/admin/privilege/getUserAllPrivileges",{resourceType:this.privileges.resourceType,id:this.privileges.id,privilegeType:this.privileges.privilegeType,serviceId:this.privileges.serviceId}).then((function(t){var i;1===t.code&&(0===t.data.resourceType?i=e.$refs.menuTree:1===t.data.resourceType?(e.apiTreeList=t.data.apiTree,e.apiList=t.data.apiConfig,i=e.$refs.apiTree):i=e.$refs.resourceTree,e.$nextTick((function(){t.data.resourceIds.forEach((function(e){i.setChecked(e,!0,!1)}))})))}))},tabVisible:function(e){return this.showTab.filter((function(t){return t===e})).length>0},getServiceName:function(e){var t=this.apiResources.filter((function(t){return t.location===e}));return t.length>0?t[0].name:e}}}),l=s,n=(i("9bb2"),i("cba8")),o=Object(n["a"])(l,a,r,!1,null,"3cbc658c",null);t["default"]=o.exports}}]);